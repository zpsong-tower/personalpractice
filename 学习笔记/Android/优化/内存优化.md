# 内存优化

​		**5R法则**

- Reduce 缩减：降低图片分辨率/重采样/抽稀策略
- Reuse 复用：池化策略/避免频繁创建对象，减小GC压力
- Recycle 回收：主动销毁、结束，避免内存泄露/生命周期闭环
- Refactor 重构：更合适的数据结构/更合理的程序架构
- Revalue 重审：谨慎使用Large Heap/多进程/第三方框架

## 避免OOM的产生

### 1.选择合适的数据结构

元素个数多，或增删频繁使用

`HashMap` 查询接近O(1)，插入接近O(1)，2倍扩容，无缩容机制，额外的Entry对象

否则使用

`ArrayMap` 查询O(logN)，插入O(logN)，1.5倍扩容，0.5倍缩容，无额外的对象开销，小数组复用池

若为Key为整型则应使用

`SparseArray`

如果存放的是基本类型，还可以使用

`SparseIntArray `，`SparseBooleanArray` 等

### 2.避免使用枚举

枚举类型安全，可读性强，但内存开销大

考虑使用注解解决类型安全的问题

### 3.Bitmap

- 选择实际所需的合适的分辨率
- 注意原始文件分辨率与内存缩放的结果
- 尽量不用帧动画，使用代码实现动效
- 考虑对Bitmap的重采样和复用配置

### 4.谨慎使用多进程

仅多开辟一个进程就会占用数兆的内存

### 5.谨慎使用Large Heap

大堆影响垃圾回收速度，不同Android虚拟机/机型配置的内存不一样

### 6.使用NDK

使用NDK在物理内存上分配，没有专门的限制

内存大户的核心逻辑放在Native层，如游戏或其他OpenGL重度用户，地图App等

